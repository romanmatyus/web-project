var datagridSortable,datagridSortableTree;$(document).on("click","[data-datagrid-confirm]",function(t){return confirm($(t.target).closest("a").attr("data-datagrid-confirm"))?void 0:(t.stopPropagation(),t.preventDefault())}),$.nette.ext("datagrid.confirm",{before:function(t,e){var a;return e.nette&&(a=e.nette.el.data("datagrid-confirm"))?confirm(a):void 0}}),$(document).on("change","select[data-autosubmit]",function(){return $(this).closest("form").submit()}).on("change","input[data-autosubmit][data-autosubmit-change]",function(t){var e,a;return a=t.which||t.keyCode||0,clearTimeout(window.datagrid_autosubmit_timer),e=$(this),window.datagrid_autosubmit_timer=setTimeout(function(t){return function(){return e.closest("form").submit()}}(this),200)}).on("keyup","input[data-autosubmit]",function(t){var e,a;return a=t.which||t.keyCode||0,13!==a&&(a>=9&&40>=a||a>=112&&123>=a)?void 0:(clearTimeout(window.datagrid_autosubmit_timer),e=$(this),window.datagrid_autosubmit_timer=setTimeout(function(t){return function(){return e.closest("form").submit()}}(this),200))}),document.addEventListener("change",function(t){var e,a,d,i,r,n,o,l,s,c;if(d=t.target.getAttribute("data-check"),d&&(e=document.querySelector(".datagrid-"+d+" input[data-check]:checked"),c=document.querySelector(".datagrid-"+d+' select[name="group_action[group_action]"]'),c&&(e?c.disabled=!1:(c.disabled=!0,c.value="")),r=window.navigator.userAgent.indexOf("MSIE "),r?(a=document.createEvent("Event"),a.initEvent("change",!0,!0)):a=new Event("change",{bubbles:!0}),c&&c.dispatchEvent(a)),d=t.target.getAttribute("data-check-all")){for(o=document.querySelectorAll("input[type=checkbox][data-check-all-"+d+"]"),s=[],i=0,l=o.length;l>i;i++)n=o[i],n.checked=t.target.checked,r=window.navigator.userAgent.indexOf("MSIE "),r?(a=document.createEvent("Event"),a.initEvent("change",!0,!0)):a=new Event("change",{bubbles:!0}),s.push(n.dispatchEvent(a));return s}}),window.datagridSerializeUrl=function(t,e){var a=[];for(var d in t)if(t.hasOwnProperty(d)){var i=e?e+"["+d+"]":d,r=t[d];r&&a.push("object"==typeof r?window.datagridSerializeUrl(r,i):encodeURIComponent(i)+"="+encodeURIComponent(r))}return a.join("&")},datagridSortable=function(){return"undefined"!=typeof $(".datagrid [data-sortable]").sortable?$(".datagrid [data-sortable]").sortable({handle:".handle-sort",items:"tr",update:function(t,e){var a,d,i,r,n;return r=e.item.closest("tr[data-id]"),a=r.data("id"),i=null,d=null,r.prev().length&&(i=r.prev().data("id")),r.next().length&&(d=r.next().data("id")),n=$(this).data("sortable-url"),$.nette.ajax({type:"GET",url:n,data:{item_id:a,prev_id:i,next_id:d},error:function(t,e,a){return alert(t.statusText)}})}}):void 0},datagridSortable(),datagridSortableTree=function(){return"undefined"!=typeof $(".datagrid-tree-item-children").sortable?$(".datagrid-tree-item-children").sortable({handle:".handle-sort",items:".datagrid-tree-item",toleranceElement:"> .datagrid-tree-item-content",connectWith:".datagrid-tree-item-children",update:function(t,e){var a,d,i,r,n,o,l;return $(".toggle-tree-to-delete").remove(),o=e.item.closest(".datagrid-tree-item[data-id]"),a=o.data("id"),n=null,d=null,r=null,o.prev().length&&(n=o.prev().data("id")),o.next().length&&(d=o.next().data("id")),i=o.parent().closest(".datagrid-tree-item"),i.length&&(i.find(".datagrid-tree-item-children").first().css({display:"block"}),i.addClass("has-children"),r=i.data("id")),(l=$(this).data("sortable-url"))?(i.find("[data-toggle-tree]").first().removeClass("hidden"),$.nette.ajax({type:"GET",url:l,data:{item_id:a,prev_id:n,next_id:d,parent_id:r},error:function(t,e,a){return"abort"!==a?alert(t.statusText):void 0}})):void 0},stop:function(){return $(".toggle-tree-to-delete").removeClass("toggle-tree-to-delete")},start:function(t,e){var a;return a=e.item.parent().closest(".datagrid-tree-item"),a.length&&2===a.find(".datagrid-tree-item").length?a.find("[data-toggle-tree]").addClass("toggle-tree-to-delete"):void 0}}):void 0},datagridSortableTree(),$.nette.ext("datagrid.happy",{success:function(){var t,e,a,d,i,r,n,o,l,s,c,u,g,h;for(window.happy&&window.happy.reset(),n=$(".datagrid"),h=[],o=0,u=n.length;u>o;o++){for(r=n[o],d=r.classList,a="",c=0,g=d.length;g>c;c++)t=d[c],a=a+"."+t;e=document.querySelectorAll(a+" input[data-check]:checked"),1===e.length&&"toggle-all"===e[0].getAttribute("name")?(s=document.querySelector(a+" input[name=toggle-all]"),s?(s.checked=!1,l=window.navigator.userAgent.indexOf("MSIE "),l?(i=document.createEvent("Event"),i.initEvent("change",!0,!0)):i=new Event("change",{bubbles:!0}),h.push(s.dispatchEvent(i))):h.push(void 0)):h.push(void 0)}return h}}),$.nette.ext("datagrid.sortable",{success:function(){return datagridSortable()}}),$.nette.ext("datagrid.forms",{success:function(){return $(".datagrid").find("form").each(function(){return window.Nette.initForm(this)})}}),$.nette.ext("datagrid.url",{success:function(t){var e,a,d,i;return t._datagrid_url&&window.history.pushState?(e=window.location.protocol+"//"+window.location.host,a=window.location.pathname,d=window.datagridSerializeUrl(t.state).replace(/&+$/gm,""),i=d?e+a+"?"+d.replace(/\&*$/,""):e+a,i+=window.location.hash,window.history.pushState({path:i},"",i)):void 0}}),$.nette.ext("datargid.item_detail",{before:function(t,e){var a,d;return e.nette&&e.nette.el.attr("data-toggle-detail")?(a=e.nette.el.attr("data-toggle-detail"),d=$(".item-detail-"+a),d.hasClass("loaded")?d.find(".item-detail-content").size()?(d.hasClass("toggled")?d.find(".item-detail-content").slideToggle("fast",function(t){return function(){return d.toggleClass("toggled")}}(this)):(d.toggleClass("toggled"),d.find(".item-detail-content").slideToggle("fast")),!1):(d.removeClass("toggled"),!0):d.addClass("loaded")):void 0},success:function(t){var e,a;return t._datagrid_toggle_detail?(e=t._datagrid_toggle_detail,a=$(".item-detail-"+e),a.toggleClass("toggled"),a.find(".item-detail-content").slideToggle("fast")):void 0}}),$.nette.ext("datagrid.tree",{before:function(t,e){var a;return e.nette&&e.nette.el.attr("data-toggle-tree")&&(e.nette.el.toggleClass("toggle-rotate"),a=e.nette.el.closest(".datagrid-tree-item").find(".datagrid-tree-item-children").first(),a.hasClass("loaded"))?(a.slideToggle("fast"),!1):!0},success:function(t){var e,a,d,i,r,n,o;if(t._datagrid_tree){d=t._datagrid_tree,e=$(".datagrid-tree-item[data-id="+d+"]").find(".datagrid-tree-item-children").first(),e.addClass("loaded"),r=t.snippets;for(i in r)n=r[i],a=$(n),o=$('<div class="datagrid-tree-item" id="'+i+'">'),o.attr("data-id",a.attr("data-id")),o.append(a),a.data("has-children")&&o.addClass("has-children"),e.append(o);e.addClass("loaded"),e.slideToggle("fast"),$.nette.load()}return datagridSortableTree()}}),$(document).on("click","[data-datagrid-editable-url]",function(t){var e,a,d,i,r,n,o,l;return e=$(this),e.hasClass("editing")?void 0:(e.addClass("editing"),l=e.html().trim().replace("<br>","\n"),e.data("value",l),o=$('<textarea class="form-control">'+l+"</textarea>"),i=parseInt(e.css("padding").replace(/[^-\d\.]/g,""),10),a=e.outerHeight(),n=a-i,r=Math.round(parseFloat(e.css("line-height"))),d=(a-2*i)/r,o.attr("rows",Math.round(d)),e.removeClass("edited"),e.html(o),e.find("textarea").focus().on("blur",function(){return l=$(this).val(),l!==e.data("value")&&$.nette.ajax({url:e.data("datagrid-editable-url"),data:{value:l},method:"POST"}).success(function(){return e.addClass("edited")}),e.removeClass("editing"),e.html(l)}))}),$.nette.ext("datagrid.after_inline_edit",{success:function(t){return t._datagrid_inline_edited?$("tr[data-id="+t._datagrid_inline_edited+"] > td").addClass("edited"):void 0}});